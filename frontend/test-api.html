<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        button:hover {
            background: #45a049;
        }

        #resultado {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .error {
            border-left-color: #f44336;
            background: #ffebee;
        }

        .success {
            border-left-color: #4CAF50;
            background: #e8f5e9;
        }

        h2 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }

        .section {
            margin: 20px 0;
        }

        .info {
            background: #e3f2fd;
            padding: 10px;
            border-left: 4px solid #2196F3;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ§ª Panel de Pruebas - API</h1>

        <div class="info">
            <strong>â„¹ï¸ InformaciÃ³n:</strong> Este panel prueba todos los endpoints de la API. Abre la consola (F12) para ver mÃ¡s detalles.
        </div>

        <div class="section">
            <h2>ğŸ“¦ Productos</h2>
            <button onclick="testGetProducts()">ğŸ“‹ Obtener Todos</button>
            <button onclick="testCreateProduct()">â• Crear Producto</button>
            <button onclick="testGetProductById()">ğŸ” Buscar por ID</button>
            <button onclick="testUpdateProduct()">âœï¸ Actualizar</button>
            <button onclick="testDeleteProduct()">ğŸ—‘ï¸ Eliminar</button>
        </div>

        <div class="section">
            <h2>ğŸ’° Ventas</h2>
            <button onclick="testGetSales()">ğŸ“‹ Obtener Todas</button>
            <button onclick="testCreateSale()">â• Registrar Venta</button>
        </div>

        <div class="section">
            <h2>ğŸ“Š Reportes</h2>
            <button onclick="testGetReport()">ğŸ“ˆ Reporte de Ventas</button>
        </div>

        <div id="resultado"></div>
    </div>

    <!-- Incluir archivo api.js -->
    <script src="assets/js/api.js"></script>

    <script>
        const resultDiv = document.getElementById('resultado');

        function mostrarResultado(titulo, resultado, esError = false) {
            const clase = esError ? 'error' : 'success';
            const icono = esError ? 'âŒ' : 'âœ…';

            resultDiv.className = clase;
            resultDiv.innerHTML = `
<strong>${icono} ${titulo}</strong>

${JSON.stringify(resultado, null, 2)}
            `;

            console.log(titulo, resultado);
        }

        // ========== PRUEBAS DE PRODUCTOS ==========

        async function testGetProducts() {
            console.log('ğŸ“¥ Obteniendo todos los productos...');
            mostrarResultado('Cargando productos...', { status: 'Loading...' });
            const result = await API.products.getAll();

            if (result.success) {
                const count = result.data.length;
                mostrarResultado(`âœ… ${count} Productos Obtenidos`, result.data);
            } else {
                mostrarResultado('âŒ Error al obtener productos', result, true);
            }
        }

        async function testCreateProduct() {
            const nuevoProducto = {
                name: 'CafÃ© Americano Premium',
                description: 'CafÃ© de alta calidad reciÃ©n hecho',
                price: 3.50,
                category: 'Bebidas Calientes',
                stock: 50
            };

            console.log('â• Creando nuevo producto:', nuevoProducto);
            mostrarResultado('Creando producto...', nuevoProducto);
            const result = await API.products.create(nuevoProducto);

            if (result.success) {
                mostrarResultado('âœ… Producto Creado Exitosamente', result.data);
                window.lastProductId = result.data.id;
                console.log('ğŸ’¾ Producto creado con ID:', window.lastProductId);
            } else {
                mostrarResultado('âŒ Error al crear producto', result, true);
            }
        }

        async function testGetProductById() {
            const id = window.lastProductId || prompt('Ingresa el ID del producto:');
            if (!id) return;

            console.log(`ğŸ” Buscando producto con ID: ${id}`);
            mostrarResultado(`Buscando producto ${id}...`, { status: 'Loading...' });
            const result = await API.products.getById(id);

            if (result.success) {
                mostrarResultado('âœ… Producto Encontrado', result.data);
            } else {
                mostrarResultado('âŒ Producto no encontrado', result, true);
            }
        }

        async function testUpdateProduct() {
            const id = window.lastProductId || prompt('Ingresa el ID del producto a actualizar:');
            if (!id) return;

            const datosActualizados = {
                name: 'CafÃ© Americano Premium - OFERTA',
                description: 'CafÃ© de alta calidad - Descuento especial',
                price: 2.99,
                category: 'Bebidas Calientes',
                stock: 75,
                createdAt: new Date()
            };

            console.log(`âœï¸ Actualizando producto ${id}:`, datosActualizados);
            mostrarResultado(`Actualizando producto ${id}...`, datosActualizados);
            const result = await API.products.update(id, datosActualizados);

            if (result.success) {
                mostrarResultado('âœ… Producto Actualizado', result.data);
            } else {
                mostrarResultado('âŒ Error al actualizar', result, true);
            }
        }

        async function testDeleteProduct() {
            const id = window.lastProductId || prompt('Ingresa el ID del producto a eliminar:');
            if (!id) return;

            if (!confirm(`Â¿EstÃ¡s seguro de que deseas eliminar el producto ${id}?`)) {
                return;
            }

            console.log(`ğŸ—‘ï¸ Eliminando producto ${id}`);
            mostrarResultado(`Eliminando producto ${id}...`, { status: 'Loading...' });
            const result = await API.products.delete(id);

            if (result.success) {
                mostrarResultado('âœ… Producto Eliminado Correctamente', result.data);
                window.lastProductId = null;
            } else {
                mostrarResultado('âŒ Error al eliminar', result, true);
            }
        }

        // ========== PRUEBAS DE VENTAS ==========

        async function testGetSales() {
            console.log('ğŸ“¥ Obteniendo todas las ventas...');
            mostrarResultado('Cargando ventas...', { status: 'Loading...' });
            const result = await API.sales.getAll();

            if (result.success) {
                const count = result.data.length;
                mostrarResultado(`âœ… ${count} Ventas Obtenidas`, result.data);
            } else {
                mostrarResultado('âŒ Error al obtener ventas', result, true);
            }
        }

        async function testCreateSale() {
            // Primero obtener un producto real de la BD
            const productsResult = await API.products.getAll();
            
            if (!productsResult.success || productsResult.data.length === 0) {
                mostrarResultado('âŒ No hay productos para crear una venta', {}, true);
                return;
            }

            const producto = productsResult.data[0];
            const nuevaVenta = {
                items: [
                    {
                        productId: producto.id,
                        quantity: 2
                    }
                ]
            };

            console.log('ğŸ’° Registrando nueva venta:', nuevaVenta);
            mostrarResultado('Registrando venta...', nuevaVenta);
            const result = await API.sales.create(nuevaVenta);

            if (result.success) {
                mostrarResultado('âœ… Venta Registrada Exitosamente', result.data);
                window.lastSaleId = result.data.id;
            } else {
                mostrarResultado('âŒ Error al registrar venta', result, true);
            }
        }

        // ========== PRUEBAS DE REPORTES ==========

        async function testGetReport() {
            console.log('ğŸ“Š Generando reporte de ventas...');
            mostrarResultado('Generando reporte...', { status: 'Loading...' });
            const result = await API.reports.getSalesReport();

            if (result.success) {
                mostrarResultado('âœ… Reporte Generado', result.data);
            } else {
                mostrarResultado('âŒ Error al generar reporte', result, true);
            }
        }

        // Mostrar mensaje inicial
        window.addEventListener('load', () => {
            console.log('âœ… Panel de pruebas cargado correctamente');
            console.log('Base URL:', 'http://localhost:3000/api');
            mostrarResultado('ğŸ‰ Panel de pruebas listo', {
                mensaje: 'Haz clic en cualquier botÃ³n para probar un endpoint',
                baseURL: 'http://localhost:3000/api',
                endpoints: ['GET /products', 'POST /products', 'PUT /products/:id', 'DELETE /products/:id']
            });
        });
    </script>
</body>

</html>